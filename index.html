<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Áä¨„Çπ„Ç§„Ç´„Ç≤„Éº„É† üê∂</title>

<meta name="viewport"
content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>

<style>
html,body{
  margin:0;
  padding:0;
  overflow:hidden;
  height:100vh;
  background:linear-gradient(#ffe8c7,#ffd6a5);
  font-family:sans-serif;
}

canvas{
  display:block;
  touch-action:none;
}

#scoreBox{
  position:absolute;
  top:10px;
  right:15px;
  font-size:14px;
  z-index:10;
}

#rankingBox{
  position:absolute;
  bottom:10px;
  left:10px;
  width:200px;
  font-size:12px;
  background:rgba(255,255,255,0.9);
  padding:8px;
  border-radius:8px;
  z-index:10;
}

#gameOver{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  background:white;
  padding:20px;
  border-radius:10px;
  text-align:center;
  display:none;
  z-index:20;
}

button{
  padding:8px 14px;
  border:none;
  border-radius:6px;
  background:#ff595e;
  color:white;
}
</style>
</head>
<body>

<div id="scoreBox">
Score: <span id="score">0</span><br>
High: <span id="highScore">0</span><br>
Today: <span id="dailyHigh">0</span>
</div>

<div id="rankingBox">
<b>üåç TOP5</b>
<div id="ranking"></div>
</div>

<div id="gameOver">
<h2>GAME OVER</h2>
<input id="playerName" placeholder="ÂêçÂâç">
<br><br>
<button onclick="submitScore()">ÈÄÅ‰ø°</button>
<br><br>
<button onclick="location.reload()">Retry</button>
</div>

<script>
const {Engine,Render,Runner,World,Bodies,Body,Events,Vertices} = Matter;

const width = window.innerWidth;
const height = document.documentElement.clientHeight;
const isMobile = width < 768;

const engine = Engine.create();
engine.world.gravity.y = 1.05;
engine.positionIterations = 15;
engine.velocityIterations = 15;

const world = engine.world;

const render = Render.create({
  element: document.body,
  engine: engine,
  options: {
    width: width,
    height: height,
    wireframes: false,
    background: "transparent"
  }
});

Render.run(render);
Runner.run(Runner.create(), engine);

/* ===== UÂ≠óÂûã„Ç≥„É≥„ÉÜ„ÉäÔºà1„Éë„Éº„ÉÑÔºâ ===== */

const containerWidth = isMobile ? width * 0.9 : 420;
const containerHeight = isMobile ? height * 0.6 : 520;

const centerX = width / 2;
const topY = height * 0.15;
const bottomY = topY + containerHeight;

const radius = 40;
const segments = 20;

/* UÂ≠ó„ÅÆÈ†ÇÁÇπ„Çí‰Ωú„Çã */
let points = [];

/* Â∑¶‰∏ä */
points.push({x: -containerWidth/2, y: -containerHeight/2});

/* Â∑¶‰∏ã„Åæ„Åß */
points.push({x: -containerWidth/2, y: containerHeight/2 - radius});

/* Â∑¶‰∏ã„Ç´„Éº„Éñ */
for(let i=0;i<=segments;i++){
  let angle = Math.PI - (Math.PI/2)*(i/segments);
  points.push({
    x: -containerWidth/2 + radius + Math.cos(angle)*radius,
    y: containerHeight/2 - radius + Math.sin(angle)*radius
  });
}

/* Â∫ï‰∏≠Â§Æ */
points.push({x: 0, y: containerHeight/2});

/* Âè≥‰∏ã„Ç´„Éº„Éñ */
for(let i=0;i<=segments;i++){
  let angle = (Math.PI/2)*(i/segments);
  points.push({
    x: containerWidth/2 - radius + Math.cos(angle)*radius,
    y: containerHeight/2 - radius + Math.sin(angle)*radius
  });
}

/* Âè≥‰∏ä */
points.push({x: containerWidth/2, y: -containerHeight/2});

/* „Ç≥„É≥„ÉÜ„Éä‰ΩúÊàê */
const container = Bodies.fromVertices(
  centerX,
  topY + containerHeight/2,
  [points],
  {
    isStatic:true,
    render:{visible:false}
  },
  true
);

World.add(world, container);

/* ===== „Éú„Éº„É´Ë®≠ÂÆö ===== */

const base=[18,26,36,48,62,78,100,125,160];
const sizes=base.map(s=>Math.round(s*(isMobile?0.85:0.65)));

const images=[
"images/inugame_size1.png",
"images/inugame_size2.png",
"images/inugame_size3.png",
"images/inugame_size4.png",
"images/inugame_size5.png",
"images/inugame_size6.png",
"images/inugame_size7.png",
"images/inugame_size8.png",
"images/inugame_size9.png"
];

let currentBall=null;
let score=0;
let isGameOver=false;

let highScore=localStorage.getItem("highScore")||0;
document.getElementById("highScore").innerText=highScore;

const todayKey="daily-"+new Date().toISOString().slice(0,10);
let dailyHigh=localStorage.getItem(todayKey)||0;
document.getElementById("dailyHigh").innerText=dailyHigh;

function createBall(i,x,y,s=false){
  const r=sizes[i];
  const ball=Bodies.circle(x,y,r,{
    restitution:0.1,
    friction:0.3,
    frictionAir:0.02,
    bullet:true,
    isStatic:s,
    render:{sprite:{texture:images[i],xScale:1,yScale:1}}
  });

  const img=new Image();
  img.src=images[i];
  img.onload=()=>{
    const sc=(r*2)/Math.max(img.width,img.height);
    ball.render.sprite.xScale=sc;
    ball.render.sprite.yScale=sc;
  };

  ball.sizeIndex=i;
  return ball;
}

function spawn(){
  if(isGameOver)return;
  const i=Math.floor(Math.random()*3);
  currentBall=createBall(i,centerX,topY-40,true);
  World.add(world,currentBall);
}
spawn();

function move(x){
  if(!currentBall||isGameOver)return;
  const min=centerX-containerWidth/2+30;
  const max=centerX+containerWidth/2-30;
  const fixed=Math.max(min,Math.min(max,x));
  Body.setPosition(currentBall,{x:fixed,y:topY-40});
}

window.addEventListener("mousemove",e=>move(e.clientX));
window.addEventListener("click",drop);

window.addEventListener("touchmove",e=>{
  move(e.touches[0].clientX);
});

window.addEventListener("touchstart",e=>{
  e.preventDefault();
  drop();
},{passive:false});

function drop(){
  if(currentBall&&!isGameOver){
    Body.setStatic(currentBall,false);
    currentBall=null;
    setTimeout(spawn,400);
  }
}

Events.on(engine,"collisionStart",e=>{
  e.pairs.forEach(p=>{
    const a=p.bodyA,b=p.bodyB;
    if(a.sizeIndex!==undefined&&b.sizeIndex!==undefined&&a.sizeIndex===b.sizeIndex){
      const n=a.sizeIndex+1;
      if(n<sizes.length){
        World.remove(world,a);
        World.remove(world,b);
        World.add(world,createBall(n,(a.position.x+b.position.x)/2,(a.position.y+b.position.y)/2));
        score+=(n+1)*5;
        document.getElementById("score").innerText=score;
      }
    }
  });
});
</script>

</body>
</html>
