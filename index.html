<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Áä¨„Çπ„Ç§„Ç´„Ç≤„Éº„É† üê∂</title>

<meta name="viewport"
content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>

<style>
html,body{
  margin:0;
  padding:0;
  overflow:hidden;
  height:100vh;
  background:linear-gradient(#ffe8c7,#ffd6a5);
  font-family:sans-serif;
}

canvas{
  display:block;
  touch-action:none;
}

#scoreBox{
  position:absolute;
  top:10px;
  right:15px;
  font-size:14px;
  z-index:10;
}

#rankingBox{
  position:absolute;
  bottom:10px;
  left:10px;
  width:200px;
  font-size:12px;
  background:rgba(255,255,255,0.9);
  padding:8px;
  border-radius:8px;
  z-index:10;
}

#gameOver{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  background:white;
  padding:20px;
  border-radius:10px;
  text-align:center;
  display:none;
  z-index:20;
}

button{
  padding:8px 14px;
  border:none;
  border-radius:6px;
  background:#ff595e;
  color:white;
}
</style>
</head>
<body>

<div id="scoreBox">
Score: <span id="score">0</span><br>
High: <span id="highScore">0</span>
</div>

<div id="rankingBox">
<b>üåç TOP5</b>
<div id="ranking"></div>
</div>

<div id="gameOver">
<h2>GAME OVER</h2>
<button onclick="location.reload()">Retry</button>
</div>

<script>
const {Engine,Render,Runner,World,Bodies,Body,Events} = Matter;

const width = window.innerWidth;
const height = document.documentElement.clientHeight;
const isMobile = width < 768;

const engine = Engine.create();
engine.world.gravity.y = 1.05;
engine.positionIterations = 15;
engine.velocityIterations = 15;

const world = engine.world;

const render = Render.create({
  element: document.body,
  engine: engine,
  options:{
    width:width,
    height:height,
    wireframes:false,
    background:"transparent"
  }
});

Render.run(render);
Runner.run(Runner.create(), engine);

/* ===== ÂÆπÂô®„Çµ„Ç§„Ç∫ ===== */

const containerWidth = isMobile ? width*0.9 : 420;
const containerHeight = isMobile ? height*0.6 : 520;

const centerX = width/2;
const topY = height*0.15;
const bottomY = topY + containerHeight;

const wallThickness = 40;
const cornerRadius = 40;

/* ===== Áâ©ÁêÜÁî®„ÅÆË¶ã„Åà„Å™„ÅÑÂ£Å ===== */

const leftWall = Bodies.rectangle(
  centerX-containerWidth/2,
  bottomY-containerHeight/2,
  wallThickness,
  containerHeight,
  {isStatic:true, render:{visible:false}}
);

const rightWall = Bodies.rectangle(
  centerX+containerWidth/2,
  bottomY-containerHeight/2,
  wallThickness,
  containerHeight,
  {isStatic:true, render:{visible:false}}
);

const bottomWall = Bodies.rectangle(
  centerX,
  bottomY+20,
  containerWidth,
  60,
  {isStatic:true, render:{visible:false}}
);

World.add(world,[leftWall,rightWall,bottomWall]);

/* ===== Ë¶ã„ÅüÁõÆÁî®UÂ≠ó„ÇíÊèèÁîª ===== */

Events.on(render, "afterRender", function() {
  const ctx = render.context;

  ctx.beginPath();
  ctx.lineWidth = 6;
  ctx.strokeStyle = "#8b5e3c";

  ctx.moveTo(centerX-containerWidth/2, topY);
  ctx.lineTo(centerX-containerWidth/2, bottomY-cornerRadius);

  ctx.arc(
    centerX-containerWidth/2+cornerRadius,
    bottomY-cornerRadius,
    cornerRadius,
    Math.PI,
    Math.PI/2,
    true
  );

  ctx.lineTo(centerX+containerWidth/2-cornerRadius, bottomY);

  ctx.arc(
    centerX+containerWidth/2-cornerRadius,
    bottomY-cornerRadius,
    cornerRadius,
    Math.PI/2,
    0,
    true
  );

  ctx.lineTo(centerX+containerWidth/2, topY);

  ctx.stroke();
});

/* ===== „Éú„Éº„É´ ===== */

const sizes=[20,28,40,55,75,100,130];
let currentBall=null;

function spawn(){
  const ball=Bodies.circle(centerX,topY-40,sizes[0],{
    restitution:0.1,
    friction:0.3,
    frictionAir:0.02
  });
  currentBall=ball;
  World.add(world,ball);
}
spawn();

function move(x){
  if(!currentBall)return;
  const min=centerX-containerWidth/2+30;
  const max=centerX+containerWidth/2-30;
  const fixed=Math.max(min,Math.min(max,x));
  Body.setPosition(currentBall,{x:fixed,y:topY-40});
}

window.addEventListener("mousemove",e=>move(e.clientX));
window.addEventListener("click",()=>currentBall=null);

window.addEventListener("touchmove",e=>{
  move(e.touches[0].clientX);
});

window.addEventListener("touchstart",e=>{
  e.preventDefault();
  currentBall=null;
},{passive:false});

</script>

</body>
</html>
