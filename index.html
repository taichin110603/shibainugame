// 合体・消去処理
Events.on(engine,"collisionStart",event=>{
  event.pairs.forEach(pair=>{
    const a = pair.bodyA;
    const b = pair.bodyB;
    if(a.sizeIndex!==undefined && b.sizeIndex!==undefined && a!==currentBall && b!==currentBall){
      if(a.sizeIndex === b.sizeIndex){
        const newSize = (a.sizeIndex<sizes.length-1)?a.sizeIndex+1:sizes.length-1;

        // 一番大きいサイズ同士なら消去
        if(a.sizeIndex === sizes.length-1 && b.sizeIndex === sizes.length-1){
          World.remove(world,a);
          World.remove(world,b);
          return; // 終了
        }

        const newBall = createBall(
          newSize,
          (a.position.x+b.position.x)/2,
          (a.position.y+b.position.y)/2
        );
        World.remove(world,a);
        World.remove(world,b);
        World.add(world,newBall);

        score += (newSize+1)*5;
        document.getElementById("score").innerText = score;

        if(score>highScore){
          highScore=score;
          localStorage.setItem("highScore",highScore);
          document.getElementById("highScore").innerText = highScore;
        }
      }
    }
  });
});
