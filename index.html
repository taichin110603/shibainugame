<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>çŠ¬ã‚¹ã‚¤ã‚«ã‚²ãƒ¼ãƒ  ğŸ¶</title>

<meta name="viewport"
content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>

<style>
html,body{
  margin:0;
  padding:0;
  overflow:hidden;
  height:100vh;
  background:linear-gradient(#ffe8c7,#ffd6a5);
  font-family:sans-serif;
}

/* ===== å®¹å™¨ï¼ˆè¦‹ãŸç›®ï¼‰ ===== */
#containerVisual{
  position:absolute;
  left:50%;
  transform:translateX(-50%);
  border-left:6px solid #8b5e3c;
  border-right:6px solid #8b5e3c;
  border-bottom:6px solid #8b5e3c;
  border-bottom-left-radius:40px;
  border-bottom-right-radius:40px;
  pointer-events:none;
  z-index:1;
}

canvas{
  position:absolute;
  top:0;
  left:0;
  z-index:0;
  touch-action:none;
}

#scoreBox{
  position:absolute;
  top:10px;
  right:15px;
  font-size:14px;
  z-index:10;
}
</style>
</head>
<body>

<div id="containerVisual"></div>

<div id="scoreBox">
Score: <span id="score">0</span>
</div>

<script>
const {Engine,Render,Runner,World,Bodies,Body} = Matter;

const width = window.innerWidth;
const height = document.documentElement.clientHeight;
const isMobile = width < 768;

const engine = Engine.create();
engine.world.gravity.y = 1.05;
engine.positionIterations = 15;
engine.velocityIterations = 15;

const world = engine.world;

const render = Render.create({
  element: document.body,
  engine: engine,
  options:{
    width:width,
    height:height,
    wireframes:false,
    background:"transparent"
  }
});

Render.run(render);
Runner.run(Runner.create(), engine);

/* ===== å®¹å™¨ã‚µã‚¤ã‚º ===== */

const containerWidth = isMobile ? width*0.9 : 420;
const containerHeight = isMobile ? height*0.6 : 520;

const centerX = width/2;
const topY = height*0.15;
const bottomY = topY + containerHeight;

/* ===== CSSå®¹å™¨ã®ã‚µã‚¤ã‚ºåæ˜  ===== */
const visual = document.getElementById("containerVisual");
visual.style.width = containerWidth + "px";
visual.style.height = containerHeight + "px";
visual.style.top = topY + "px";

/* ===== ç‰©ç†ã®è¦‹ãˆãªã„å£ ===== */

const wallThickness = 40;

const leftWall = Bodies.rectangle(
  centerX-containerWidth/2,
  bottomY-containerHeight/2,
  wallThickness,
  containerHeight,
  {isStatic:true, render:{visible:false}}
);

const rightWall = Bodies.rectangle(
  centerX+containerWidth/2,
  bottomY-containerHeight/2,
  wallThickness,
  containerHeight,
  {isStatic:true, render:{visible:false}}
);

const bottomWall = Bodies.rectangle(
  centerX,
  bottomY+20,
  containerWidth,
  60,
  {isStatic:true, render:{visible:false}}
);

World.add(world,[leftWall,rightWall,bottomWall]);

/* ===== ãƒœãƒ¼ãƒ« ===== */

let currentBall=null;

function spawn(){
  const ball=Bodies.circle(centerX,topY-40,20,{
    restitution:0.1,
    friction:0.3,
    frictionAir:0.02
  });
  currentBall=ball;
  World.add(world,ball);
}
spawn();

function move(x){
  if(!currentBall)return;
  const min=centerX-containerWidth/2+30;
  const max=centerX+containerWidth/2-30;
  const fixed=Math.max(min,Math.min(max,x));
  Body.setPosition(currentBall,{x:fixed,y:topY-40});
}

window.addEventListener("mousemove",e=>move(e.clientX));
window.addEventListener("click",()=>currentBall=null);

window.addEventListener("touchmove",e=>{
  move(e.touches[0].clientX);
});

window.addEventListener("touchstart",e=>{
  e.preventDefault();
  currentBall=null;
},{passive:false});
</script>

</body>
</html>
